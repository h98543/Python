### 并发和并行

并发：多个任务之间快速切换，交替短暂的占用CPU，看起来就像同时执行一样

并行：多个任务同事使用CPU，真正的并行执行多任务只能在多核CPU上实现

例子：

![图片](./1.jpg)

并发是两个队列交替使用一台咖啡机，并行是两个队列同时使用两台咖啡机

### 进程和线程

一个任务就是一个进程（Process），比如打开一个浏览器就是启动一个浏览器进程，打开一个记事本就启动了一个记事本进程，打开两个记事本就启动了两个记事本进程，打开一个Word就启动了一个Word进程。

有些进程还不止同时干一件事，比如Word，它可以同时进行打字、拼写检查、打印等事情。在一个进程内部，要同时干多件事，就需要同时运行多个“子任务”，我们把进程内的这些“子任务”称为线程（Thread）。

每个进程都有自己独立的一块内存空间，一个进程可以有多个线程，该进程的所有线程共享一块内存空间。

这代表一个线程使用某些共享内存时，其他线程必须等它结束，才能使用这一块内存。一个防止其他线程进入的简单方法，就是门口加一把锁。先到的线程锁上门，后到的线程看到上锁，就在门口排队，等锁打开再进去。这就叫"互斥锁"（Mutual exclusion，缩写 Mutex），防止多个线程同时读写某一块内存区域。

还有些内存空间，可以同时容纳 n 个线程。也就是说，如果线程数大于n，多出来的线程只能在外面等着。

这时的解决方法，就是在门口挂n把钥匙。进去的线程就取一把钥匙，出来时再把钥匙挂回原处。后到的线程发现钥匙架空了，就知道必须在门口排队等着了。这种做法叫做"信号量"（Semaphore），用来保证多个线程不会互相冲突。

互斥锁是信号量种特殊情况（n=1时）

### Python中的多进程和多线程

我们前面编写的所有的Python程序，都是执行单任务的进程，也就是只有一个线程。如果我们要同时执行多个任务，有三种解决方案：
- 多进程模式： 启动多个进程，每个进程虽然只有一个线程，但多个进程可以一块执行多个任务。
- 多线程模式： 启动一个进程，在一个进程内启动多个线程，这样，多个线程也可以一块执行多个任务。
- 多进程+多线程模式： 启动多个进程，每个进程再启动多个线程，这样同时执行的任务就更多了，当然这种模型更复杂，实际很少采用。


